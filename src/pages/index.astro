---
import { getCollection } from "astro:content";
import Container from "@components/Container.astro";
import PageLayout from "@layouts/PageLayout.astro";
import ArrowCard from "@components/ArrowCard.astro";
import ArrowCardThumbnail from "@components/ArrowCardThumbnail.astro";
import Link from "@components/Link.astro";
import Hero from "@components/Hero.astro";
import { dateRange } from "@lib/utils";
import { SITE, HOME } from "@consts";

const blog = (await getCollection("blog"))
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, SITE.NUM_POSTS_ON_HOMEPAGE);

const projects = (await getCollection("projects"))
  .filter((project) => !project.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, SITE.NUM_PROJECTS_ON_HOMEPAGE);

const allwork = (await getCollection("work"))
  .sort(
    (a, b) =>
      new Date(b.data.dateStart).valueOf() -
      new Date(a.data.dateStart).valueOf(),
  )
  .slice(0, SITE.NUM_WORKS_ON_HOMEPAGE);

const work = await Promise.all(
  allwork.map(async (item) => {
    const { Content } = await item.render();
    return { ...item, Content };
  }),
);
---

<PageLayout title={HOME.TITLE} description={HOME.DESCRIPTION}>
  <Container>
    <Hero />

    <div
      class="grid grid-cols-1 md:grid-cols-2 gap-12 md:gap-16 pb-16 items-start"
    >
      <!-- Left Column: Work Experience -->
      <div class="flex flex-col gap-12 md:gap-4 order-2 md:order-1">
        <section class="animate">
          <div class="h-20 flex items-center justify-between">
            <h5
              class="font-semibold text-black dark:text-white uppercase tracking-wider text-sm"
            >
              Work Experience
            </h5>
            <Link href="/work" class="text-sm"> See all work </Link>
          </div>
          <ul class="flex flex-col gap-8">
            {
              work.map((entry) => (
                <li class="animate relative">
                  <div class="shadow-ascii">
                    <div class="relative bg-[#faf9f6] dark:bg-slate-950 px-4 py-4 border border-black/10 dark:border-white/10">
                      <div class="flex flex-wrap items-baseline gap-x-1">
                    <div class="font-semibold text-black dark:text-white">
                      {entry.data.company}
                    </div>
                    <div class="text-xs opacity-60">
                      {dateRange(entry.data.dateStart, entry.data.dateEnd)}
                    </div>
                  </div>
                  <div class="text-sm opacity-75 mb-4 uppercase tracking-wide font-medium">
                    {entry.data.role}
                  </div>
                  <article class="prose-sm">
                    <entry.Content />
                  </article>
                    </div>
                  </div>
                </li>
              ))
            }
          </ul>
        </section>
      </div>

      <!-- Right Column: Recent Projects and Latest Posts -->
      <div class="flex flex-col gap-12 md:gap-4 order-1 md:order-2">
        <section class="animate">
          <div class="h-20 flex items-center justify-between">
            <h5
              class="font-semibold text-black dark:text-white uppercase tracking-wider text-sm"
            >
              Recent projects
            </h5>
            <Link href="/projects" class="text-sm"> See all projects </Link>
          </div>
          <ul class="flex flex-col gap-8 m-0 p-0 list-none">
            {
              projects.map((project) => (
                <li class="animate">
                  <ArrowCardThumbnail entry={project} />
                </li>
              ))
            }
          </ul>
        </section>

        <section class="animate">
          <div class="h-20 flex items-center justify-between">
            <h5
              class="font-semibold text-black dark:text-white uppercase tracking-wider text-sm"
            >
              Latest posts
            </h5>
            <Link href="/blog" class="text-sm"> See all posts </Link>
          </div>
          <ul class="flex flex-col gap-8 m-0 p-0 list-none">
            {
              blog.map((post) => (
                <li class="animate">
                  <ArrowCard entry={post} />
                </li>
              ))
            }
          </ul>
        </section>
      </div>
    </div>
  </Container>
</PageLayout>
